<!DOCTYPE html>
<html lang="en">
<head>
   <link rel="stylesheet" href="./assets/css/styles.css">
</head>
<body>

   <!-- SCREENS -->
<main id="dashboard" class="dashboard" data-screen="dashboard">
  <div class="dash-card" id="dash-fasting-card">
    <div class="dash-title-row">
      <div class="dash-title">Fasting</div>
      <div class="dash-streak" id="dash-streak">ğŸ”¥ Streak: 0</div>
    </div>

    <div class="dash-timer-row">
      <div class="dash-big" id="dash-main">Not fasting</div>
      <div class="dash-sub" id="dash-sub">Tap the spark to open Lumina</div>
    </div>

    <!-- FASTING STAGE (new) -->
<div class="dash-stage">
  <div class="dash-stage-left">
    <div class="dash-stage-label">Stage</div>
    <div class="dash-stage-value" id="dash-stage">â€”</div>
  </div>

  <div class="dash-stage-right">
    <div class="dash-stage-label">Next</div>
    <div class="dash-stage-value" id="dash-next">â€”</div>
  </div>
</div>

<div class="dash-milestones" id="dash-milestones">
  <div class="milestone" data-ms="0">0h</div>
  <div class="milestone" data-ms="12">12h</div>
  <div class="milestone" data-ms="16">16h</div>
  <div class="milestone" data-ms="24">24h</div>
</div>

    <div class="dash-bar-bg">
      <div class="dash-bar-fill" id="dash-bar"></div>
    </div>

    <div class="dash-meta" id="dash-meta">â€”</div>
  </div>
</main>

<!-- FASTING TAB (CONTROL CENTER) -->
<main id="screen-fasting" class="dashboard hidden" data-screen="fasting">
  <div class="dash-card">
    <div class="dash-title-row">
      <div class="dash-title">Fasting</div>
      <div class="dash-streak" id="fasting-status-pill">â³ Not fasting</div>
    </div>

    <div class="dash-timer-row">
      <div class="dash-big" id="fasting-main">Not fasting</div>
      <div class="dash-sub" id="fasting-sub">Start a fast to see progress + stages.</div>
    </div>

    <!-- Stage / Next -->
    <div class="dash-stage">
      <div class="dash-stage-left">
        <div class="dash-stage-label">Stage</div>
        <div class="dash-stage-value" id="fasting-stage">â€”</div>
      </div>

      <div class="dash-stage-right">
        <div class="dash-stage-label">Next</div>
        <div class="dash-stage-value" id="fasting-next">â€”</div>
      </div>
    </div>

    <!-- Milestones -->
    <div class="dash-milestones" id="fasting-milestones">
      <div class="milestone" data-ms="0">0h</div>
      <div class="milestone" data-ms="12">12h</div>
      <div class="milestone" data-ms="16">16h</div>
      <div class="milestone" data-ms="24">24h</div>
    </div>

    <!-- Progress -->
    <div class="dash-bar-bg">
      <div class="dash-bar-fill" id="fasting-bar"></div>
    </div>

    <div class="dash-meta" id="fasting-meta">â€”</div>

    <!-- Controls -->
    <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:14px;">
      <!-- Presets -->
      <button class="pill" type="button" onclick="startFast(12)">â³ 12h</button>
      <button class="pill" type="button" onclick="startFast(16)">âš¡ 16h</button>
      <button class="pill" type="button" onclick="startFast(18)">ğŸ”¥ 18h</button>
      <button class="pill" type="button" onclick="startFast(20)">ğŸ›¡ 20h</button>
      <button class="pill" type="button" onclick="startFast(24)">ğŸ‘‘ 24h</button>

      <!-- Custom (uses your existing modal) -->
      <button class="pill" type="button" onclick="toggleModal('fast-modal')">ğŸ§© Custom</button>

      <!-- End -->
      <button class="pill" type="button" onclick="confirm('End current fast?') && endFast()">ğŸ§¨ End fast</button>

      <!-- Quick logs -->
      <button class="pill" type="button" onclick="toggleModal('meal-modal')">ğŸ¥— Log meal</button>
    </div>
  </div>
</main>

<main id="screen-coach" class="dashboard hidden" data-screen="coach">
  <div class="dash-card">
    <div class="dash-title-row">
      <div class="dash-title">Coach</div>
      <div class="dash-streak">âœ¨</div>
    </div>
    <div class="dash-timer-row">
      <div class="dash-big">Coming soon</div>
      <div class="dash-sub">Weâ€™ll add routines + guidance here.</div>
    </div>
    <div class="dash-meta">â€”</div>
  </div>
</main>

<main id="screen-exercise" class="dashboard hidden" data-screen="exercise">
  <div class="dash-card">
    <div class="dash-title-row">
      <div class="dash-title">Exercise</div>
      <div class="dash-streak">ğŸ’ª</div>
    </div>
    <div class="dash-timer-row">
      <div class="dash-big">Coming soon</div>
      <div class="dash-sub">Weâ€™ll add workouts + tracking here.</div>
    </div>
    <div class="dash-meta">â€”</div>
  </div>
</main>

<main id="screen-profile" class="dashboard hidden" data-screen="profile">
  <div class="dash-card">
    <div class="dash-title-row">
      <div class="dash-title">Profile</div>
      <div class="dash-streak">âš™ï¸</div>
    </div>
    <div class="dash-timer-row">
      <div class="dash-big">Coming soon</div>
      <div class="dash-sub">Settings + goals will live here.</div>
    </div>
    <div class="dash-meta">â€”</div>
  </div>
</main>



<!-- BOTTOM TAB BAR (single source of truth) -->
<nav id="bottom-nav" class="bottom-nav" aria-label="Main tabs">
  <button class="tab active" data-tab="dashboard" type="button">ğŸ <span>Home</span></button>
  <button class="tab" data-tab="fasting" type="button">â³<span>Fasting</span></button>
  <button class="tab" data-tab="coach" type="button">âœ¨<span>Coach</span></button>
  <button class="tab" data-tab="exercise" type="button">ğŸ’ª<span>Exercise</span></button>
  <button class="tab" data-tab="profile" type="button">âš™ï¸<span>Profile</span></button>
</nav>

    <!-- ASSISTANT BUBBLE -->
    <button id="assistant-bubble" class="assistant-bubble" aria-label="Open assistant" onclick="openAssistant()">
        âœ¦
    </button>

    <!-- ASSISTANT OVERLAY -->
    <div id="assistant-overlay" class="assistant-overlay hidden" onclick="overlayClickClose(event)">
        <div class="assistant-sheet" role="dialog" aria-modal="true" aria-label="Lumina Assistant">
            <div class="assistant-topbar">
                <div class="assistant-topbar-title">Lumina</div>
                <button class="assistant-close" onclick="closeAssistant()" aria-label="Close assistant">Ã—</button>
            </div>

            <div class="assistant-shell">
                <header>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h1 style="font-size: 1.2rem; font-weight: 700; letter-spacing: -0.5px;">LUMINA <span style="color:var(--accent-blue); font-size: 0.7rem; vertical-align: middle;">V1</span></h1>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="toggleModal('settings-modal')" class="btn-ghost">Settings</button>
                        </div>
                    </div>
                    <div class="state-chips">
                        <div id="chip-status" class="chip active">â— Offline</div>
                        <div id="chip-elapsed" class="chip">0h 0m elapsed</div>
                        <div id="chip-streak" class="chip">ğŸ”¥ Streak: 0</div>
                        <div id="chip-hunger" class="chip">Hunger: --</div>
                        <div id="chip-energy" class="chip">Energy: --</div>
                    </div>
                </header>

                <div id="timer-ui" class="timer-container hidden">
                    <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                        <div>
                            <div id="status-text" style="font-size: 0.75rem; color: var(--accent-blue); font-weight: 600; text-transform: uppercase;">Fasting Active</div>
                            <div id="main-timer-display" style="font-size: 1.8rem; font-weight: 800; margin-top: 2px;">00:00:00</div>
                        </div>
                        <div id="badge-display" style="font-size: 0.7rem; background: rgba(0,210,255,0.1); padding: 4px 8px; border-radius: 8px; color: var(--accent-blue);">Pre-Ketosis</div>
                    </div>
                    <div class="progress-bar-bg">
                        <div id="progress-fill" class="progress-bar-fill"></div>
                    </div>
                    <div class="timer-stats">
                        <span id="start-time-label">Started: --:--</span>
                        <span id="end-time-label">Goal: --:--</span>
                    </div>
                </div>

                <div id="chat-container"></div>

                <div class="controls-wrapper">
                    <div class="quick-actions">
                        <div class="pill" onclick="handleAction('hunger')">ğŸ˜« I'm hungry</div>
                        <div id="pill-fast-toggle" class="pill" onclick="handleAction('fast-menu')">âš¡ Start Fast</div>
                        <div class="pill" onclick="handleAction('meal-menu')">ğŸ¥— Log Meal</div>
                        <div class="pill" onclick="handleAction('stats')">ğŸ“Š Stats</div>
                    </div>
                    <div class="input-bar">
                        <input type="text" id="chat-input" placeholder="Ask Lumina..." onkeypress="if(event.key === 'Enter') sendMessage()">
                        <button id="btn-voice" class="btn-mic" onclick="toggleVoiceCapture()" title="Voice mode">ğŸ™</button>
                        <button class="btn-send" onclick="sendMessage()">â†’</button>
                    </div>
                    <div class="disclaimer">Not medical advice. Consult a physician before fasting.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="fast-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 style="margin-bottom: 0.5rem;">Plan Fast</h3>
            <div class="form-group">
                <label>Target Duration (Hours)</label>
                <select id="fast-duration">
                    <option value="12">12 Hours (Circadian)</option>
                    <option value="16" selected>16 Hours (Leangains)</option>
                    <option value="18">18 Hours (4:2)</option>
                    <option value="20">20 Hours (Warrior)</option>
                    <option value="24">24 Hours (OMAD)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Start Time</label>
                <input type="datetime-local" id="fast-start">
            </div>
            <div class="form-group">
                <label>Last Meal Note (Optional)</label>
                <input type="text" id="fast-note" placeholder="What did you last eat?">
            </div>
            <button class="btn-primary" onclick="startFast()">Activate Fast</button>
            <button class="btn-ghost" onclick="toggleModal('fast-modal')">Cancel</button>
        </div>
    </div>

    <div id="meal-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Log Meal</h3>
            <div class="form-group">
                <label>What did you eat?</label>
                <input type="text" id="meal-text" placeholder="e.g. Avocado Toast, 2 eggs">
            </div>
            <div class="form-group">
                <label>Time</label>
                <input type="datetime-local" id="meal-time">
            </div>
            <div class="form-group">
                <label>Hunger before (1-5)</label>
                <input type="range" id="meal-hunger" min="1" max="5" value="3" oninput="this.nextElementSibling.innerText = this.value">
                <span style="font-size:0.8rem; color:var(--accent-blue); text-align:center;">3</span>
            </div>
            <button class="btn-primary" onclick="saveMeal()">Log Meal</button>
            <button class="btn-ghost" onclick="toggleModal('meal-modal')">Cancel</button>
        </div>
    </div>

    <div id="settings-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>System Controls</h3>
            <button class="btn-ghost" onclick="exportData()">Export JSON Data</button>
            <button class="btn-ghost" onclick="triggerImport()">Import JSON Data</button>
            <input type="file" id="import-input" accept=".json" style="display:none;" onchange="importData(event)">
            <button class="btn-ghost" style="color: #ff4444;" onclick="resetDay()">Reset Today's Data</button>
            <button class="btn-primary" onclick="toggleModal('settings-modal')">Close</button>
        </div>
    </div>
    
   <!-- SCRIPTS -->
<script src="assets/js/fastingStages.js"></script>
<script src="assets/js/app.js"></script>
</body>
</html>