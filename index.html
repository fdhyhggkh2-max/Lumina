<!DOCTYPE html>
<html lang="en">
<head>
   <link rel="stylesheet" href="./assets/css/styles.css">
</head>
<body>

    <!-- DASHBOARD VIEW -->
    <main id="dashboard" class="dashboard">
        <div class="dash-card" id="dash-fasting-card">
            <div class="dash-title-row">
                <div class="dash-title">Fasting</div>
                <div class="dash-streak" id="dash-streak">üî• Streak: 0</div>
            </div>

            <div class="dash-timer-row">
                <div class="dash-big" id="dash-main">Not fasting</div>
                <div class="dash-sub" id="dash-sub">Tap the spark to open Lumina</div>
            </div>

            <div class="dash-bar-bg">
                <div class="dash-bar-fill" id="dash-bar"></div>
            </div>

            <div class="dash-meta" id="dash-meta">‚Äî</div>
        </div>
    </main>

    <!-- ASSISTANT BUBBLE -->
    <button id="assistant-bubble" class="assistant-bubble" aria-label="Open assistant" onclick="openAssistant()">
        ‚ú¶
    </button>

    <!-- ASSISTANT OVERLAY -->
    <div id="assistant-overlay" class="assistant-overlay hidden" onclick="overlayClickClose(event)">
        <div class="assistant-sheet" role="dialog" aria-modal="true" aria-label="Lumina Assistant">
            <div class="assistant-topbar">
                <div class="assistant-topbar-title">Lumina</div>
                <button class="assistant-close" onclick="closeAssistant()" aria-label="Close assistant">√ó</button>
            </div>

            <div class="assistant-shell">
                <header>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h1 style="font-size: 1.2rem; font-weight: 700; letter-spacing: -0.5px;">LUMINA <span style="color:var(--accent-blue); font-size: 0.7rem; vertical-align: middle;">V1</span></h1>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="toggleModal('settings-modal')" class="btn-ghost">Settings</button>
                        </div>
                    </div>
                    <div class="state-chips">
                        <div id="chip-status" class="chip active">‚óè Offline</div>
                        <div id="chip-elapsed" class="chip">0h 0m elapsed</div>
                        <div id="chip-streak" class="chip">üî• Streak: 0</div>
                        <div id="chip-hunger" class="chip">Hunger: --</div>
                        <div id="chip-energy" class="chip">Energy: --</div>
                    </div>
                </header>

                <div id="timer-ui" class="timer-container hidden">
                    <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                        <div>
                            <div id="status-text" style="font-size: 0.75rem; color: var(--accent-blue); font-weight: 600; text-transform: uppercase;">Fasting Active</div>
                            <div id="main-timer-display" style="font-size: 1.8rem; font-weight: 800; margin-top: 2px;">00:00:00</div>
                        </div>
                        <div id="badge-display" style="font-size: 0.7rem; background: rgba(0,210,255,0.1); padding: 4px 8px; border-radius: 8px; color: var(--accent-blue);">Pre-Ketosis</div>
                    </div>
                    <div class="progress-bar-bg">
                        <div id="progress-fill" class="progress-bar-fill"></div>
                    </div>
                    <div class="timer-stats">
                        <span id="start-time-label">Started: --:--</span>
                        <span id="end-time-label">Goal: --:--</span>
                    </div>
                </div>

                <div id="chat-container"></div>

                <div class="controls-wrapper">
                    <div class="quick-actions">
                        <div class="pill" onclick="handleAction('hunger')">üò´ I'm hungry</div>
                        <div id="pill-fast-toggle" class="pill" onclick="handleAction('fast-menu')">‚ö° Start Fast</div>
                        <div class="pill" onclick="handleAction('meal-menu')">ü•ó Log Meal</div>
                        <div class="pill" onclick="handleAction('stats')">üìä Stats</div>
                    </div>
                    <div class="input-bar">
                        <input type="text" id="chat-input" placeholder="Ask Lumina..." onkeypress="if(event.key === 'Enter') sendMessage()">
                        <button id="btn-voice" class="btn-mic" onclick="toggleVoiceCapture()" title="Voice mode">üéô</button>
                        <button class="btn-send" onclick="sendMessage()">‚Üí</button>
                    </div>
                    <div class="disclaimer">Not medical advice. Consult a physician before fasting.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="fast-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 style="margin-bottom: 0.5rem;">Plan Fast</h3>
            <div class="form-group">
                <label>Target Duration (Hours)</label>
                <select id="fast-duration">
                    <option value="12">12 Hours (Circadian)</option>
                    <option value="16" selected>16 Hours (Leangains)</option>
                    <option value="18">18 Hours (4:2)</option>
                    <option value="20">20 Hours (Warrior)</option>
                    <option value="24">24 Hours (OMAD)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Start Time</label>
                <input type="datetime-local" id="fast-start">
            </div>
            <div class="form-group">
                <label>Last Meal Note (Optional)</label>
                <input type="text" id="fast-note" placeholder="What did you last eat?">
            </div>
            <button class="btn-primary" onclick="startFast()">Activate Fast</button>
            <button class="btn-ghost" onclick="toggleModal('fast-modal')">Cancel</button>
        </div>
    </div>

    <div id="meal-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Log Meal</h3>
            <div class="form-group">
                <label>What did you eat?</label>
                <input type="text" id="meal-text" placeholder="e.g. Avocado Toast, 2 eggs">
            </div>
            <div class="form-group">
                <label>Time</label>
                <input type="datetime-local" id="meal-time">
            </div>
            <div class="form-group">
                <label>Hunger before (1-5)</label>
                <input type="range" id="meal-hunger" min="1" max="5" value="3" oninput="this.nextElementSibling.innerText = this.value">
                <span style="font-size:0.8rem; color:var(--accent-blue); text-align:center;">3</span>
            </div>
            <button class="btn-primary" onclick="saveMeal()">Log Meal</button>
            <button class="btn-ghost" onclick="toggleModal('meal-modal')">Cancel</button>
        </div>
    </div>

    <div id="settings-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>System Controls</h3>
            <button class="btn-ghost" onclick="exportData()">Export JSON Data</button>
            <button class="btn-ghost" onclick="triggerImport()">Import JSON Data</button>
            <input type="file" id="import-input" accept=".json" style="display:none;" onchange="importData(event)">
            <button class="btn-ghost" style="color: #ff4444;" onclick="resetDay()">Reset Today's Data</button>
            <button class="btn-primary" onclick="toggleModal('settings-modal')">Close</button>
        </div>
    </div>

   <script src="./assets/js/app.js" defer></script>
</body>
</html>